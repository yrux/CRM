"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[329],{5333:(e,t,r)=>{r.d(t,{Z:()=>u});var n=r(7757),a=r.n(n);function i(e,t,r,n,a,i,s){try{var c=e[i](s),o=c.value}catch(e){return void r(e)}c.done?t(o):Promise.resolve(o).then(n,a)}function s(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var s=e.apply(t,r);function c(e){i(s,n,a,c,o,"next",e)}function o(e){i(s,n,a,c,o,"throw",e)}c(void 0)}))}}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=r(9669);const u=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,n,i,u,p,l,d;return t=e,r=[{key:"getlist",value:function(e,t){return o.get("/api/leads/".concat(e,"/payments").concat(t)).then((function(e){return e.data})).catch((function(e){return e}))}},{key:"delete",value:function(e){var t=e.lead,r=e.id;return o.delete("/api/leads/".concat(t,"/payments/").concat(r))}},{key:"create",value:(d=s(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post("/api/leads/".concat(t,"/payments"),r).then((function(e){return{status:1,data:e.data.data}})).catch((function(e){return{status:0,data:e.response.data.errors}}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return d.apply(this,arguments)})},{key:"get",value:(l=s(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.get("/api/leads/".concat(t,"/payments/").concat(r));case 2:return n=e.sent,e.abrupt("return",n.data.data);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return l.apply(this,arguments)})},{key:"update",value:(p=s(a().mark((function e(t,r,n){var i;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.append("_method","put"),e.next=3,o.post("/api/leads/".concat(n,"/payments/").concat(r),t).then((function(e){return{status:1,data:e.data.data}})).catch((function(e){return{status:0,data:e.response.data.errors}}));case 3:return i=e.sent,e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)}))),function(e,t,r){return p.apply(this,arguments)})},{key:"checkEmail",value:(u=s(a().mark((function e(t,r){var n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post("/api/payments/"+t,r).then((function(e){return{status:1,data:e.data}})).catch((function(e){return{status:0,data:e.response.message}}));case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e)}))),function(e,t){return u.apply(this,arguments)})},{key:"getBrand",value:(i=s(a().mark((function e(t){var r;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.post("/api/payments-getbrand/"+t).then((function(e){return e.data}));case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})}],r&&c(t.prototype,r),n&&c(t,n),e}())},5329:(e,t,r)=>{r.r(t),r.d(t,{default:()=>u});var n=r(7757),a=r.n(n),i=r(5333);function s(e,t,r,n,a,i,s){try{var c=e[i](s),o=c.value}catch(e){return void r(e)}c.done?t(o):Promise.resolve(o).then(n,a)}function c(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var i=e.apply(t,r);function c(e){s(i,n,a,c,o,"next",e)}function o(e){s(i,n,a,c,o,"throw",e)}c(void 0)}))}}const o={data:function(){return{stripe:{stripe:void 0,elements:void 0,card:void 0},payment_id:"",email:"",brand:{},loading:!1,emailError:[],emailVerified:!1,payment:{}}},mounted:function(){var e=this;return c(a().mark((function t(){return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.payment_id=e.$route.params.id,t.next=3,i.Z.getBrand(e.payment_id);case 3:e.brand=t.sent;case 4:case"end":return t.stop()}}),t)})))()},methods:{handleStripePayment:function(e){var t=this;return c(a().mark((function r(){var n,i;return a().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e.preventDefault(),r.next=3,t.stripe.stripe.confirmSetup({elements:t.stripe.elements,confirmParams:{return_url:t.payment.success_url}});case 3:n=r.sent,(i=n.error)&&(document.querySelector("#error-message").textContent=i.message);case 6:case"end":return r.stop()}}),r)})))()},verifyEmail:function(){var e=this;return c(a().mark((function t(){var r,n,s;return a().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.emailError=[],e.loading=!0,(r=new FormData).append("email",e.email),t.next=6,i.Z.checkEmail(e.payment_id,r);case 6:if(n=t.sent,e.loading=!1,!n.status){t.next=16;break}return e.emailVerified=!0,t.next=12,e.$nextTick();case 12:e.payment=n.data,"stripe"==e.payment.type&&(e.stripe.stripe=Stripe(e.payment.stripe_pk),s={clientSecret:e.payment.client_secret,appearance:{}},e.stripe.elements=e.stripe.stripe.elements(s),e.stripe.card=e.stripe.elements.create("payment"),e.stripe.card.mount(e.$refs.stripecard)),t.next=19;break;case 16:e.email="",e.$store.commit("setNotification","Invalid Email"),e.emailError=["Invalid Email"];case 19:case"end":return t.stop()}}),t)})))()}}};const u=(0,r(1900).Z)(o,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("v-row",[r("v-col",{attrs:{cols:"12"}},[r("v-img",{attrs:{contain:"","lazy-src":e.brand.image_url,src:e.brand.image_url,"max-height":"200"}})],1)],1),e._v(" "),e.emailVerified?r("v-row",[r("h2",[e._v("Step 2")]),e._v(" "),r("v-col",{attrs:{cols:"12"}},[r("form",{attrs:{id:"payment-form"},on:{submit:e.handleStripePayment}},[r("div",{ref:"stripecard",attrs:{id:"payment-element"}}),e._v(" "),r("v-btn",{attrs:{type:"submit",color:"green","text-color":"white",id:"submit"}},[e._v("Submit")]),e._v(" "),r("div",{attrs:{id:"error-message"}})],1)])],1):r("v-row",[r("v-col",{attrs:{cols:"12"}},[r("v-text-field",{attrs:{"error-messages":e.emailError,label:"Email",hint:"Provide your email address to verify",required:""},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}})],1),e._v(" "),r("v-col",{attrs:{cols:"12"}},[r("v-btn",{staticClass:"white--text",attrs:{loading:e.loading,disabled:e.loading,color:"blue-grey float-right"},on:{click:e.verifyEmail}},[e._v("\n        Verify\n      ")])],1)],1)],1)}),[],!1,null,null,null).exports}}]);